<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Regular image detection • geosam</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="image-detection_files/libs/quarto-html/popper.min.js"></script><script src="image-detection_files/libs/quarto-html/tippy.umd.min.js"></script><link href="image-detection_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="image-detection_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Regular image detection">
<meta property="og:image" content="https://walker-data.com/geosam/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">geosam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/satellite-detection.html">Satellite Imagery Detection</a></li>
    <li><a class="dropdown-item" href="../articles/image-detection.html">Regular Image Detection</a></li>
    <li><a class="dropdown-item" href="../articles/interactive.html">Interactive Workflows</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/walkerke/geosam/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Regular image detection</h1>




      <small class="dont-index">Source: <a href="https://github.com/walkerke/geosam/blob/HEAD/vignettes/image-detection.qmd" class="external-link"><code>vignettes/image-detection.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>While geosam is built to work with geographic data, the package also honors SAM’s core functionality: extracting from photos, screenshots, or any image file.</p>
<section class="level2"><h2 id="basic-workflow">Basic workflow<a class="anchor" aria-label="anchor" href="#basic-workflow"></a>
</h2>
<p>To work with non-georeferenced images, use <code><a href="../reference/sam_image.html">sam_image()</a></code>. We’ll work with this sample photo for testing which is bundled in the package.</p>
<p><img src="images/fruit_plate.jpg"></p>
<p>To extract objects from an image, we pass the image path to <code><a href="../reference/sam_image.html">sam_image()</a></code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/geosam" class="external-link">geosam</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Path to bundled sample image</span></span>
<span><span class="va">fruit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"fruit_plate.jpg"</span>, package <span class="op">=</span> <span class="st">"geosam"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Detect strawberries</span></span>
<span><span class="va">berries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sam_image.html">sam_image</a></span><span class="op">(</span><span class="va">fruit</span>, text <span class="op">=</span> <span class="st">"strawberry"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">berries</span></span></code></pre></div>
</div>
<p>We get a <code>geosam_image</code> object back. This object can be plotted with <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">berries</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="image-detection_files/figure-html/unnamed-chunk-2-1.png"></p>
</figure>
</div>
</div>
</div>
<p>SAM3 has found the strawberries. We can also try different prompts on the same image, then combine the plots with <code>add = TRUE</code>, much as we would in typical base R plotting.</p>
<p>Let’s try out different prompts on the same image:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cherries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sam_image.html">sam_image</a></span><span class="op">(</span><span class="va">fruit</span>, text <span class="op">=</span> <span class="st">"cherry"</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cherries</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chocolate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sam_image.html">sam_image</a></span><span class="op">(</span><span class="va">fruit</span>, text <span class="op">=</span> <span class="st">"chocolate"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">chocolate</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, base_img <span class="op">=</span> <span class="va">p</span>, fill <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="image-detection_files/figure-html/unnamed-chunk-3-1.png"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h2 id="extracting-results">Extracting results<a class="anchor" aria-label="anchor" href="#extracting-results"></a>
</h2>
<p>Much like extracted objects from satellite images, we can convert our extractions to “spatial” objects in pixel coordinates with <code><a href="../reference/sam_as_sf.html">sam_as_sf()</a></code>. Let’s try it out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">berries_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sam_as_sf.html">sam_as_sf</a></span><span class="op">(</span><span class="va">berries</span><span class="op">)</span></span>
<span><span class="va">berries_sf</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 9 features and 3 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 178 ymin: 569 xmax: 694 ymax: 1144
CRS:           NA
  mask_id     score area_px                       geometry
1       1 0.9461025   19024 POLYGON ((259 1079, 259 107...
2       2 0.8614167   14913 POLYGON ((401 1114, 401 111...
3       3 0.9214256   13157 POLYGON ((528 859, 528 858,...
4       4 0.9081426   12381 POLYGON ((366 997, 366 996,...
5       5 0.9315553   12627 POLYGON ((436 884, 436 883,...
6       6 0.9396250   13655 POLYGON ((635 907, 635 906,...
7       7 0.8776799   11476 POLYGON ((477 1144, 477 114...
8       8 0.8411812   25324 POLYGON ((520 1027, 520 102...
9       9 0.9475598   18611 POLYGON ((562 757, 562 756,...</code></pre>
</div>
</div>
<p>Note that the result includes <code>area_px</code> (area in square pixels) instead of <code>area_m2</code>.</p>
</section><section class="level2"><h2 id="interactive-exploration">Interactive exploration<a class="anchor" aria-label="anchor" href="#interactive-exploration"></a>
</h2>
<p>For hands-on detection with clicking and drawing you can use <code><a href="../reference/sam_explore_image.html">sam_explore_image()</a></code>. Pass an image path and you’ll launch a Shiny gadget that allows you to interactively explore your image. The interface uses mapgl and MapLibre under the hood, so you can pan and zoom as if it were an interactive map. Let’s try it out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sam_explore_image.html">sam_explore_image</a></span><span class="op">(</span><span class="va">fruit</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The text option allows you to enter up to six text prompts to extract interactively from the image. Here, we show an extraction detecting cherries, strawberries, nuts, chocolate, glass, and book from the image. Our interactive viewer finds all of these objects, and gives us a map legend along with pop-ups.</p>
<p><img src="images/paste-2.png"></p>
<p>The app also supports “Example” mode where you can draw around objects to use as exemplars and “Points” mode where you can click to identify objects; see the Interactive vignette for examples of this in action with satellite imagery.</p>
<p>When you click “Done”, results are returned as a <code>geosam_image</code> object to your R session so long as you’ve assigned the result to a variable. Let’s take a look at it:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span></span></code></pre></div>
<pre><code>Simple feature collection with 76 features and 5 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: 129 ymin: 0 xmax: 1280 ymax: 1493
CRS:           NA
First 10 features:
   mask_id     score area_px   prompt prompt_color                       geometry
1        1 0.7182140    8287 cherries      #facc15 MULTIPOLYGON (((1024 753, 1...
2        2 0.5578738    3340 cherries      #facc15 POLYGON ((779 901, 779 900,...
3        3 0.6574008    2829 cherries      #facc15 POLYGON ((659 961, 659 959,...
4        4 0.7631093    8354 cherries      #facc15 POLYGON ((842 825, 842 824,...
5        5 0.8512306    9918 cherries      #facc15 POLYGON ((885 1102, 885 110...
6        6 0.7179651    3449 cherries      #facc15 POLYGON ((658 729, 658 728,...
7        7 0.8434036   10636 cherries      #facc15 POLYGON ((1014 972, 1014 97...
8        8 0.8085137    8738 cherries      #facc15 MULTIPOLYGON (((944 1018, 9...
9        9 0.7799412    8565 cherries      #facc15 POLYGON ((824 1003, 824 100...
10      10 0.7946509    7510 cherries      #facc15 POLYGON ((637 1096, 637 109...</code></pre>
<p>Note that we get back <code>prompt</code> and <code>prompt_color</code> columns that tell us which prompt is associated with each object.</p>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kyle Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
