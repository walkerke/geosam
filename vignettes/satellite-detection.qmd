---
title: "Satellite imagery detection"
format: html
editor: visual
eval: false
---

geosam detects objects in satellite imagery using natural language prompts. Describe what you're looking for, and SAM3 returns georeferenced polygons.

## Basic workflow

The `sam_detect()` function downloads satellite imagery and runs detection in one step. Here we find swimming pools in Beverly Hills:

```{r}
library(geosam)

pools <- sam_detect(
  bbox = c(-118.41, 34.09, -118.405, 34.095),
  text = "swimming pool",
  source = "mapbox",
  zoom = 18
)

pools
```

Plot the results over the imagery:

```{r}
plot(pools)
```

For interactive exploration, use `sam_view()`. This launches a Shiny app where you can adjust the confidence threshold with a slider, click polygons to see details, and export results as GeoJSON:

```{r}
sam_view(pools)
```

The viewer uses the same imagery source (Mapbox, Esri, or MapTiler) as the detection, so results align with the basemap.

## Bring your own imagery

If you have existing satellite or aerial imagery, pass the file path directly:

```{r}
# geosam includes a sample WorldView-3 chip from Mumbai (SpaceNet dataset)
mumbai <- system.file("extdata", "mumbai_chip.tif", package = "geosam")

buildings <- sam_detect(
  image = mumbai,
  text = "building"
)

plot(buildings)
```

Try different prompts on the same image:

```{r}
roads <- sam_detect(image = mumbai, text = "road")
plot(roads)

blue_roofs <- sam_detect(image = mumbai, text = "blue roof", threshold = 0.2)
plot(blue_roofs)
```

Some features need a lower `threshold` to detect - experiment to see what works for your imagery.

## Extracting results

Convert detections to an sf object for use in spatial workflows:

```{r}
library(sf)

buildings_sf <- sam_as_sf(buildings)
buildings_sf
```

The result includes polygon geometries, confidence scores, and area in square meters. Use `sam_filter()` to filter by score or area before extraction:

```{r}
filtered <- buildings |>
  sam_filter(min_area = 50, min_score = 0.6) |>
  sam_as_sf()
```
